From 6245ddddb7f80740c5c15e1750e5b9f68c5b2b5f Mon Sep 17 00:00:00 2001
From: "Seth M. Larson" <SethMichaelLarson@users.noreply.github.com>
Date: Tue, 27 Mar 2018 13:14:11 -0500
Subject: [PATCH] Stop using headers, instead use kw['headers']

---
 urllib3/poolmanager.py | 8 ++------
 1 file changed, 2 insertions(+), 6 deletions(-)

diff --git a/urllib3/poolmanager.py b/urllib3/poolmanager.py
index 53732626e..0e4525f9c 100644
--- a/urllib3/poolmanager.py
+++ b/urllib3/poolmanager.py
@@ -314,9 +314,7 @@ def urlopen(self, method, url, redirect=True, **kw):
         kw['redirect'] = False
 
         if 'headers' not in kw:
-            kw['headers'] = headers = self.headers
-        else:
-            headers = kw['headers']
+            kw['headers'] = self.headers.copy()
 
         if self.proxy is not None and u.scheme == "http":
             response = conn.urlopen(method, url, **kw)
@@ -342,8 +340,7 @@ def urlopen(self, method, url, redirect=True, **kw):
         if (retries.remove_headers_on_redirect
                 and not conn.is_same_host(redirect_location)):
             for header in retries.remove_headers_on_redirect:
-                if header in headers:
-                    headers.pop(header)
+                kw['headers'].pop(header, None)
 
         try:
             retries = retries.increment(method, url, response=response, _pool=conn)
@@ -354,7 +351,6 @@ def urlopen(self, method, url, redirect=True, **kw):
 
         kw['retries'] = retries
         kw['redirect'] = redirect
-        kw['headers'] = headers
 
         log.info("Redirecting %s -> %s", url, redirect_location)
         return self.urlopen(method, redirect_location, **kw)

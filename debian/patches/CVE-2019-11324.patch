Partial backport of:

From 1efadf43dc63317cd9eaa3e0fdb9e05ab07254b1 Mon Sep 17 00:00:00 2001
From: Seth Michael Larson <sethmichaellarson@gmail.com>
Date: Wed, 17 Apr 2019 12:46:22 -0500
Subject: [PATCH] Release 1.24.2 (#1564)

* Don't load system certificates by default when any other ``ca_certs``, ``ca_certs_dir`` or ``ssl_context`` parameters are specified.
* Remove Authorization header regardless of case when redirecting to cross-site. (Issue #1510)
* Add support for IPv6 addresses in subjectAltName section of certificates. (Issue #1269)
---
 CHANGES.rst                               | 13 +++++++-
 CONTRIBUTORS.txt                          |  3 ++
 dummyserver/certs/server.ipv6_san.crt     | 16 ++++++++++
 dummyserver/server.py                     |  5 +++
 src/urllib3/__init__.py                   |  2 +-
 src/urllib3/contrib/pyopenssl.py          |  3 ++
 src/urllib3/poolmanager.py                |  7 +++--
 src/urllib3/util/retry.py                 |  3 +-
 src/urllib3/util/ssl_.py                  |  5 ++-
 test/contrib/test_pyopenssl.py            |  5 ++-
 test/test_retry.py                        |  6 ++--
 test/test_ssl.py                          | 37 +++++++++++++++++++++++
 test/with_dummyserver/test_https.py       | 20 +++++++++++-
 test/with_dummyserver/test_poolmanager.py | 26 ++++++++++++++++
 14 files changed, 140 insertions(+), 11 deletions(-)
 create mode 100644 dummyserver/certs/server.ipv6_san.crt

Index: python-urllib3-1.22/urllib3/util/ssl_.py
===================================================================
--- python-urllib3-1.22.orig/urllib3/util/ssl_.py	2019-05-13 14:27:52.704194258 -0400
+++ python-urllib3-1.22/urllib3/util/ssl_.py	2019-05-13 14:27:52.700194243 -0400
@@ -319,7 +319,10 @@ def ssl_wrap_socket(sock, keyfile=None,
             if e.errno == errno.ENOENT:
                 raise SSLError(e)
             raise
-    elif getattr(context, 'load_default_certs', None) is not None:
+
+    # Don't load system certs unless there were no CA certs or
+    # SSLContext object specified manually.
+    elif ssl_context is None and hasattr(context, 'load_default_certs'):
         # try to load OS default certs; works well on Windows (require Python3.4+)
         context.load_default_certs()
 
